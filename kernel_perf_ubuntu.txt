$ sudo echo "deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse" >> /etc/apt/sources.list.d/ddebs.list
$ sudo echo "deb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse >> /etc/apt/sources.list.d/ddebs.list
$ sudo echo "deb http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse" >> /etc/apt/sources.list.d/ddebs.list
$ wget -O - http://ddebs.ubuntu.com/dbgsym-release-key.asc | sudo apt-key add -
$ sudo apt-get update

$ sudo apt install linux-image-`uname -r`-dbgsym linux-tools-`uname -r` linux-tools-generic linux-tools-common
$ sudo apt install clang bcc bpfcc-tools
$ sudo snap install bpftrace

# http://www.brendangregg.com/Slides/LISA2017_Container_Performance_Analysis.pdf
$ sudo sh -c 'echo 0 > /proc/sys/kernel/perf_event_paranoid'
$ sudo sh -c 'echo 0 > /proc/sys/kernel/kptr_restrict'
$ sudo sysctl -w kernel.perf_event_max_stack=512

# http://www.brendangregg.com/Slides/DockerCon2017_performance_analysis.pdf
#   The 'perf record' command  samples at 99hz, all CPUs (-a), callstack/symbols (-g --call-graph) and for 60 seconds
#   Record IN the FlameGraph folder; the 'perf script' commands wants the perf.data file generated in same folder
# http://www.brendangregg.com/perf.html
#   Many other kernel perf usages

$ git clone --depth 1 https://github.com/brendangregg/FlameGraph
$ cd FlameGraph
$ perf record –F 99 -a –g --call-graph dwarf -- sleep 60
$ perf script | ./stackcollapse-perf.pl | ./flamegraph.pl > perf.svg
